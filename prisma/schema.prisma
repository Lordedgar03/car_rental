datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

enum AvailabilityStatus {
  available
  unavailable
  maintenance
}

enum AdminRole {
  owner
  admin
  staff
}

enum LeadStatus {
  pendente
  confirmada
  em_andamento
  concluida
  cancelada
}

enum LeadContactChannel {
  whatsapp
  email
  telefone
  outro
}

model Car {
  id                 String             @id @default(cuid())
  name               String
  category           String
  imageUrl           String             @db.LongText
  passengers         Int
  transmission       String
  fuel               String
  pricePerDay        Int
  featured           Boolean            @default(false)
  availabilityStatus AvailabilityStatus @default(available)
  year               Int
  description        String?            @db.Text
  isActive           Boolean            @default(true)

  leads              Lead[]

  createdAt          DateTime           @default(now())
  updatedAt          DateTime           @updatedAt

  @@index([availabilityStatus])
  @@index([isActive])
  @@index([category])
}

model Lead {
  id                String             @id @default(cuid())
  status            LeadStatus         @default(pendente)

  customerName      String
  customerEmail     String?
  customerPhone     String?
  contactChannel    LeadContactChannel @default(whatsapp)

  pickupDate        DateTime?
  returnDate        DateTime?
  pickupLocation    String?
  dropoffLocation   String?

  carId             String?
  car               Car?               @relation(fields: [carId], references: [id], onDelete: SetNull)

  message           String?            @db.Text
  notes             String?            @db.Text

  createdAt         DateTime           @default(now())
  updatedAt         DateTime           @updatedAt

  @@index([status])
  @@index([carId])
  @@index([createdAt])
}

model AdminUser {
  id           String        @id @default(cuid())
  name         String
  email        String        @unique
  passwordHash String
  role         AdminRole     @default(admin)
  isActive     Boolean       @default(true)
  lastLoginAt  DateTime?

  sessions     AdminSession[]

  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
}

model AdminSession {
  id          String    @id @default(cuid())
  adminUserId String
  tokenHash   String    @unique
  expiresAt   DateTime
  createdAt   DateTime  @default(now())

  adminUser   AdminUser @relation(fields: [adminUserId], references: [id], onDelete: Cascade)

  @@index([adminUserId])
  @@index([expiresAt])
}

model Setting {
  key       String   @id
  value     String   @db.Text
  updatedAt DateTime @updatedAt
}
